import"./default-CIqDDot3.js";var n=null,u=[];window.onload=function(){function o(){var e=location.href,t=e.split("id=")[1];return t.includes("&")&&(t=t.split("&")[0]),t}function m(){var e=location.href,t=e.split("rank=")[1];return t.includes("&")&&(t=t.split("&")[0]),t}function d(){var e=location.href,t=e.split("patchVersion=")[1];return t.includes("&")&&(t=t.split("&")[0]),t}function g(e,t){return total=e+t,total==0?0:(win_rate=Math.round(e/total*100),win_rate)}function y(){var e=location.href,t=e.split("minPlayedCount=")[1];return t.includes("&")&&(t=t.split("&")[0]),t}function v(){var e=location.href,t=e.split("winrate=")[1];return t.includes("&")&&(t=t.split("&")[0]),t}function f(e,t,s,a,r,i,l,c){var _=`<tr>
                    <td>${e}</td>
                    <td align="left"><a id="${e}" href="#" style="display: flex; flex-direction: row; align-items: center;">
                    <img src="${t}"><span>${s}</span></a></td>
                    <td><img src="img/rank_icon_${a}.png"></td>
                    <td>${r}</td>
                    <td>${i}</td>
                    <td>${l}</td>
                    <td>${c}%</td>`;document.getElementById("bodyPlayers").insertAdjacentHTML("beforeend",_),document.getElementById(e).addEventListener("click",S=>{window.open(`https://www.opendota.com/players/${e}/matches?hero_id=${o()}&party_size=1&patch=${d()}&lobby_type=7`)})}function h(e,t){return e>=y()&&t>v()}function p(e,t,s){new Promise((a,r)=>{var i=d(),l=`https://api.opendota.com/api/players/${e}/wl?hero_id=${s}&patch=${i}&party_size=1&lobby_type=7`;$.ajax({type:"GET",url:l,success:function(c){a(c)},error:function(c,_,S){r()}})}).then(function(a){var r=a.win,i=a.lose;win_rate=g(r,i),total_match_count=r+i,h(total_match_count,win_rate)&&f(e,t,n[0].personaname,n[0].rank_tier/10,total_match_count,r,i,win_rate);var l={playerId:e,avatarSrc:t,person:n[0].personaname,rankTier:n[0].rank_tier/10,matches:total_match_count,win:r,lose:i,winRate:win_rate};u.push(e),sessionStorage.setItem(`${o()}_${e}`,JSON.stringify(l)),sessionStorage.setItem(`${o()}_appended`,JSON.stringify(u))}).catch(function(a){console.log(`에러났음 : ${a}`)}).finally(()=>{if(n.shift(),n.length>0){const a=n[0].account_id,r=n[0].avatar;p(a,r,o())}})}async function w(){try{const s=(await(await fetch("/api/players")).json()).data;for(let a=0;a<s.length;a++){const i=s[a].rank_tier;((i=="0"||i==null)=="false"||Number(i)<Number(m()))&&s.splice(a,1)}if(n=Array.from(s),sessionStorage.setItem(o(),JSON.stringify(n)),n.length>0){const a=n[0].account_id,r=n[0].avatar;p(a,r,o())}}catch(e){console.error("Error fetching players:",e)}}function k(){n=sessionStorage.getItem(o()),n==null?w():(n=JSON.parse(n),u=JSON.parse(sessionStorage.getItem(`${o()}_appended`)),u.forEach(e=>{var t=JSON.parse(sessionStorage.getItem(`${o()}_${e}`));h(t.matches,t.winRate)&&f(t.playerId,t.avatarSrc,t.person,t.rankTier,t.matches,t.win,t.lose,t.winRate),n.shift()}),n.length>0&&p(n[0].account_id,n[0].avatar,o()))}k()};
